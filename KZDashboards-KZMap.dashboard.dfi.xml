<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Document name="KZDashboards-KZMap.dashboard.DFI">
<dashboard xmlns="http://www.intersystems.com/deepsee/library" name="KZMap" folderName="KZDashboards" title="" description="" keywords="" owner="" shared="true" public="true" locked="false" resource="" timeCreated="2013-07-04T05:29:56.446Z" createdBy="ilson" category="" bookCover="" scheme="" worklistCount="0" snapTo="true" snapGrid="true" gridRows="10" gridCols="10" canResize="true" canModify="true" showTitleBar="true" companyName="" companyLogo="" companyStyle="">
  <widget name="MapW" type="portlet" subtype="KZ.MapPortlet" subtypeClass="" title="Казахстан" dataSource="KZMapKPI.kpi" dataLink="" drillDownDataSource="" width="200" height="200" sidebarContent="" showSidebar="false" sidebarWidth="" maximized="false" homeRowL="0" homeColL="0" colSpanL="10" rowSpanL="10" showToolbar="true" theme="" dataColorList="">
    <control name="" action="applyFilter" target="*" targetProperty="ParentGuid" location="widget" type="hidden" controlClass="" label="ParentGuid" title="" value="" text="" readOnly="false" valueList="" displayList="" activeWhen=""></control>
    <control name="" action="applyFilter" target="*" targetProperty="ParameterName" location="widget" type="dropdown" controlClass="" label="Параметр" title="" value="Население" text="" readOnly="false" valueList="" displayList="" activeWhen=""></control>
    <control name="" action="applyFilter" target="" targetProperty="PolygonsMarkers" location="widget" type="dropdown" controlClass="" label="Вариант отображения" title="" value="Polygons" text="" readOnly="false" valueList="" displayList="" activeWhen=""></control>
    <property name="colorProperty">Color</property>
    <property name="coordsJsFile">polygonsKZ.js</property>
    <property name="coordsProperty">Guid</property>
    <property name="drillUpButtonPosition">top</property>
    <property name="fillOpacity">0.6</property>
    <property name="getAdditionInfoForObjectById"></property>
    <property name="getBordersMethod"></property>
    <property name="hoverOpacity">0.4</property>
    <property name="latitude">49</property>
    <property name="latitudeProperty">Latitude</property>
    <property name="longitude">66</property>
    <property name="longitudeProperty">Longitude</property>
    <property name="mapType">Дорожная карта:yandex#map</property>
    <property name="onclickplacemark"><![CDATA[   
    	var content = "<div style='font-family: arial; font-size: 12px;'>" + 
    						"<b>" + placemark.data.Name + "</b><br>" + 
    						"<i>onclickplacemark</i>" + 
    				  "</div>";
    				  	
      	zenThis.openBallonAtPosition(placemark.geometry.getCoordinates(), content);
    ]]></property>
    <property name="onclickpolygon"><![CDATA[       	
    	if(!zenThis.lastPolygon){     		
        	zenThis.lastPolygon = [];
    	}    	 				  		
     
     	zenThis.drillDown(polygon.data.Name, position, polygon.data.DefaultZoom, {Guid: polygon.data.Guid, Level: polygon.data.Level});   		  		
     
     	if (zenThis.lastPolygon.length > 0){
		 	zenThis.lastPolygon[zenThis.lastPolygon.length - 1].options.set('visible', false);
     	}
     	
     	zenThis.currPolygon = new ymaps.Polygon(
     		polygon.geometry.getCoordinates(), 
     		{
	     		hintContent: polygon.data.Name
	     	}, 
     		{
	     		fill: false,
        	 	zIndex: 1,
        	 	strokeColor: polygon.options.get('fillColor'),
        	 	strokeWidth: 4,
        	 	strokeOpacity: 0.9
    		});

     	zenThis.lastPolygon.push(zenThis.currPolygon);
     	zenThis.getMapObject().geoObjects.add(zenThis.currPolygon);
     ]]></property>
    <property name="ondrilldown">
    	console.log("dash ondrilldown");
    	
   		if(!zenThis.lastGuid){ 
    		zenThis.lastGuid = [];
    		zenThis.lastLevel = [];
    		zenThis.currGuid = '';
    		zenThis.currName = '';
    		zenThis.currLevel = '';
   		}
   		
   		zenThis.lastLevel.push(zenThis.currLevel);  
   		zenThis.lastGuid.push(zenThis.currGuid);
   		
   		zenThis.currLevel = data.Level;
   		zenThis.currGuid = data.Guid;
   	
   		zenPage.dashboardEventHandler(zenThis, 'click', zenThis.currGuid, 'applyFilter', '*', 'ParentGuid');  
    </property>
    <property name="ondrillup"><![CDATA[
    if (zenThis.lastGuid){  
		zenThis.currGuid = zenThis.lastGuid.pop();
		zenThis.currLevel = zenThis.lastLevel.pop();
  		zenThis.currPolygon = zenThis.lastPolygon.pop();
  			
		zenPage.dashboardEventHandler(zenThis,'click', zenThis.currGuid, 'applyFilter', '*', 'ParentGuid');          
	
	  	if (zenThis.lastPolygon.length > 0){
		   	zenThis.lastPolygon[zenThis.lastPolygon.length - 1].options.set('visible', true);
        }
            
		if (zenThis.currPolygon){          
			zenThis.getMapObject().geoObjects.remove(zenThis.currPolygon);
		}
	}
    ]]></property>
    <property name="onrightclickplacemark"><![CDATA[  
    	var content = "<div style='font-family: arial; font-size: 12px;'>" + 
    						"<b>" + placemark.data.Name + "</b><br>" + 
    						"<i>onrightclickplacemark</i>" + 
    				  "</div>";
    				  	
      	zenThis.openBallonAtPosition(placemark.geometry.getCoordinates(), content);
    ]]></property>
    <property name="onrightclickpolygon"><![CDATA[  
      zenThis.openBallonAtPosition(position, '<div><b>RightPolygonClick</b><br><i>polygon</i></div>');
    
    ]]></property>
    <property name="placemarkDataProperties">Name,Guid,DefaultZoom,CanDrillDown,Value,ParameterId,Level,CenterName,SpecialIcon</property>
    <property name="placemarkIcon">http://i.imgur.com/pBB7MYT.png</property>
    <property name="placemarkSpecialIcon">http://i.imgur.com/bFJRQfv.png</property>
    <property name="placemarkSpecialProperty">SpecialIcon</property>
    <property name="placemarkTitleProperty">Name</property>
    <property name="polygonDataProperties">Name,Guid,DefaultZoom,CanDrillDown,Value,DataUrl,ParameterId,Level,CenterName,Color</property>
    <property name="polygonTitleProperty">Name</property>
    <property name="saveBordersMethod"></property>
    <property name="strokeOpacity">1</property>
    <property name="strokeWeight">1</property>
    <property name="zoom">4</property>
  </widget>
</dashboard>
</Document></Export>
